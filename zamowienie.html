<!DOCTYPE html>
<html lang="pl">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5DV82ZN5');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <title>Twoje Słodkie Zamówienie</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #fff5f7; display: flex; align-items: center; min-height: 100vh; }
        .checkout-box { max-width: 550px; margin: auto; background: white; padding: 40px; border-radius: 30px; border: 6px solid #ffb7c5; }
        .price-total { font-size: 2.2rem; font-weight: bold; color: #f72585; }
        .discount-badge { color: #28a745; font-weight: bold; }
        .btn-buy-final { background-color: #f72585; color: white; border: none; padding: 18px; width: 100%; border-radius: 50px; font-weight: bold; font-size: 1.3rem; margin-top: 20px; transition: 0.2s; }
        .btn-buy-final:hover { transform: scale(1.02); background-color: #d61c6f; }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5DV82ZN5"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <div class="checkout-box shadow-lg">
            <h2 class="text-center mb-4" style="color: #f72585; font-family: 'Pacifico', cursive;">Finalizuj Zamówienie</h2>
            
            <div class="alert alert-warning text-center small">
                Cena bazowa: <strong>1.20 PLN</strong> / szt.<br>
                Rabat: 10+ (10%), 20+ (15%), 100+ (30%)
            </div>

            <p class="text-center">Wybrałeś: <strong id="prod-name">-</strong></p>

            <form id="purchase-form">
                <div class="mb-3">
                    <label class="form-label font-weight-bold">Ilość sztuk:</label>
                    <input type="number" id="qty-input" class="form-control form-control-lg text-center" value="1" min="1">
                </div>

                <div class="mb-3">
                    <label class="form-label">Imię i Nazwisko</label>
                    <input type="text" class="form-control" id="u-name" required placeholder="np. Anna Nowak">
                </div>
                <div class="mb-3">
                    <label class="form-label">Telefon kontaktowy</label>
                    <input type="tel" class="form-control" id="u-phone" required placeholder="123 456 789">
                </div>
                <div class="mb-3">
                    <label class="form-label">Uwagi (opcjonalnie)</label>
                    <textarea class="form-control" id="u-msg" rows="2"></textarea>
                </div>

                <div class="text-center mt-4 p-3 bg-light rounded-4">
                    <div id="discount-info" class="discount-badge mb-1"></div>
                    <div class="small text-muted text-decoration-line-through" id="old-price" style="display:none;"></div>
                    <div class="price-total"><span id="total-val">0.00</span> PLN</div>
                </div>

                <button type="submit" id="final-buy-button" class="btn-buy-final">POTWIERDZAM I KUPUJĘ</button>
            </form>
            <a href="index.html" class="d-block text-center mt-3 text-muted small text-decoration-none">Wróć do sklepu</a>
        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const pName = params.get('product') || "Pączek";
        document.getElementById('prod-name').innerText = pName;

        const qtyField = document.getElementById('qty-input');
        const basePrice = 1.20;

        function updatePrice() {
            let qty = parseInt(qtyField.value) || 0;
            let total = qty * basePrice;
            let discount = 0;

            if (qty >= 100) discount = 0.30;
            else if (qty >= 20) discount = 0.15;
            else if (qty >= 10) discount = 0.10;

            const discInfo = document.getElementById('discount-info');
            const oldPriceDisp = document.getElementById('old-price');
            const totalDisp = document.getElementById('total-val');

            if (discount > 0) {
                discInfo.innerText = "Twój Rabat: " + (discount * 100) + "%";
                oldPriceDisp.style.display = "block";
                oldPriceDisp.innerText = total.toFixed(2) + " PLN";
                total = total * (1 - discount);
            } else {
                discInfo.innerText = "";
                oldPriceDisp.style.display = "none";
            }

            totalDisp.innerText = total.toFixed(2);
        }

        qtyField.addEventListener('input', updatePrice);
        updatePrice();

        document.getElementById('purchase-form').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Sukces! Zamówienie na ' + qtyField.value + ' pączków przekazane do systemu.');
        });
    </script>
</body>
</html>